---
title: Cisco ASA stateful failover: подводные камни
layout: post
published: false
---

Настраивал на этой неделе [отказоустойчивую пару Cisco ASA 5512-X](http://www.cisco.com/c/en/us/td/docs/security/asa/asa93/configuration/general/asa-general-cli/ha-failover.html#pgfId-1494550). Отличительная особенность фейловера у ASA - так называемый [stateful failover](http://www.cisco.com/c/en/us/td/docs/security/asa/asa93/configuration/general/asa-general-cli/ha-failover.html#pgfId-1495008). Технология очень крутая. Как говорится "не единого разрыва". Одно из устройств можно спокойно выключить, перезагрузить, взровать - ни одно соединение не порвется. Достигается такой эффект за счет непрерывной репликации статуса соединений между устройствами по отдельному линку. Реплцируется почти все - arp таблица, tcp сессии, udp сессии, Site-to-Site IPsec (всего около 20 пунктов). 

Документация говорит, что для stateful falover между устройствами необходимо настроить двасоединения - failover link и stateful link. Если есть взможность, рекомендуется пустить эти линки по разным фищическим каналам. Если же разных L2 каналов нет, то failover link и stateful link можно объединить. Далее все примеры в документации приводятся для случая, когда мы настраиваем два разных линка. 

В моем случае двух разных физических сред нет было. При таком раскладе надежнее настроить один Ether Chanell на два разных свитча в стеке. Тут и возникли небольшие проблемы.
